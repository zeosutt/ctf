from pwn import *
import itertools
import shlex
from Crypto.Util.number import *

n = 26507591511689883990023896389022361811173033984051016489514421457013639621509962613332324662222154683066173937658495362448733162728817642341239457485221865493926211958117034923747221236176204216845182311004742474549095130306550623190917480615151093941494688906907516349433681015204941620716162038586590895058816430264415335805881575305773073358135217732591500750773744464142282514963376379623449776844046465746330691788777566563856886778143019387464133144867446731438967247646981498812182658347753229511846953659235528803754112114516623201792727787856347729085966824435377279429992530935232902223909659507613583396967
e = 65537

command = 'cat flag'

c = int(command.encode('hex'), 16)

for k in itertools.count(2):
	ck = (c * pow(k, e, n)) % n

	ck_str = long_to_bytes(ck)
	try:
		if shlex.split(ck_str)[0] != ck_str:
			continue
	except Exception:
		continue

	r = remote('blind.q.2019.volgactf.ru', 7070)

	r.sendlineafter('Enter your command:\r\n', '0 sign')
	r.sendlineafter('Enter your command to sign:\r\n', ck_str.encode('base64').replace('\n', ''))

	mk = int(r.recvline())
	sig = mk * inverse(k, n) % n

	r.sendlineafter('Enter your command:\r\n', str(sig) + ' ' + command)

	r.interactive()

	break
